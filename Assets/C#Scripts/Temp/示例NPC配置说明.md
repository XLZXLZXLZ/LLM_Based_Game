# 示例 NPC 配置说明

## 📋 创建测试用的 NPCProfile

### 方法1: 在 Unity 编辑器中创建

1. 在 Project 窗口右键 → `Create` → `ScriptableObject` → `NPCProfile`
2. 重命名为 `TestNPC_神秘商人`
3. 在 Inspector 中配置以下内容：

```
NPC ID: test_npc_merchant_001
Character Name: 神秘商人

Background (角色背景):
我是一个在边境小镇经营古董店的商人。
我知道一些关于古代遗迹的秘密，但不会轻易告诉陌生人。
我的妹妹在一次探险中失踪了，这让我变得更加谨慎。

Personality (性格特征):
谨慎、神秘、略显忧郁
对待陌生人保持警惕，但内心善良
一旦建立信任，会变得非常热情

Speaking Style (对话风格):
说话简洁，留有余地
经常使用反问句来试探对方
会在关键时刻沉默片刻再回答

Goals (角色目标):
找到失踪的妹妹
保护古代遗迹的秘密不被坏人利用
寻找值得信任的冒险者

Additional Info (其他信息):
对古代文物有深入研究
擅长鉴定宝物的真伪
会根据玩家的诚意决定透露多少信息
```

4. 创建或选择一个 `LLMProfile`，设置到 NPCProfile 中

---

## 🎯 测试场景建议

### 场景1: 初次见面（测试首次思考）

**对话建议**:
```
玩家: 你好，这里是古董店吗？
玩家: 我听说你知道一些古代遗迹的事？
玩家: 能告诉我更多吗？
```

**预期行为**:
- NPC 应该保持谨慎态度
- 思考显示："这个人类看起来友善，但我不能完全信任他..."
- 行为指导："保持谨慎但不失礼貌的态度..."

---

### 场景2: 建立信任（测试思考更新）

**对话建议**:
```
玩家: 我想帮你找回你的妹妹
玩家: 我是个有经验的冒险者
玩家: 我保证不会泄露你的秘密
```

**预期行为**:
- 经过5次对话后，NPC重新思考
- 思考更新："这个人确实有诚意，也许可以信任他..."
- 行为指导："可以透露更多信息，但仍保留核心秘密..."

---

### 场景3: 提取长期记忆

**对话建议**（包含需要记住的关键信息）:
```
玩家: 我答应帮你找到你的妹妹
玩家: 如果我找到了红色水晶，我会带一块给你
玩家: 我的名字叫艾登
玩家: 我最喜欢在月光下散步
```

**预期记忆提取**:
- [promise|0.9] 玩家答应帮助神秘商人寻找失踪的妹妹
- [promise|0.8] 玩家承诺找到红色水晶后会带一块给商人
- [detail|0.7] 玩家的名字叫艾登
- [preference|0.6] 玩家喜欢在月光下散步

---

### 场景4: 测试记忆检索

**在添加了长期记忆后，继续对话**:
```
玩家: 你还记得我之前答应过你什么吗？
玩家: 我找到了你要的东西
```

**预期行为**:
- NPC 应该能记住之前的承诺
- 在系统提示词中会包含相关的长期记忆
- NPC 回复会提到之前的承诺

---

## 📊 完整测试流程

### 第1-2次对话（首次思考）
```
【思考触发】首次对话
【内心想法】这个陌生人突然询问古董店和遗迹，我需要小心...
【行为指导】保持礼貌但不透露关键信息，试探对方意图

对话:
玩家: 你好，这里是古董店吗？
NPC: (略显警惕) 是的...你有什么事吗？

玩家: 我想了解一些古代遗迹的信息
NPC: (打量着你) 为什么对那些地方感兴趣？
```

### 第3-5次对话（思考有效期内）
```
【思考状态】使用中 (2/5)
【内心想法】(保持不变)
【行为指导】(保持不变)

对话:
玩家: 我是个冒险者，想去探险
NPC: (依然谨慎) 那里很危险，你确定吗？

玩家: 我做好了准备
NPC: ...好吧，我可以给你一些线索

玩家: 谢谢你的信任
NPC: (语气稍微缓和) 不要谢得太早...
```

### 第6次对话（触发重新思考）
```
【思考触发】达到间隔 (5次对话)
【LLM判断】需要更新思考
【内心想法】这个人看起来确实有诚意，而且态度诚恳...
【行为指导】可以透露更多信息，但仍要保留核心秘密

对话:
玩家: 你的妹妹是怎么失踪的？
NPC: (沉默片刻，语气温和了许多) 她...她去了北方的遗迹...
```

### 第7-10次对话（上下文溢出）
```
【触发】MaxHistoryCount = 5, 当前10条
【处理】最旧的5条 → 短期记忆总结
【保留】最新的5条对话

【短期记忆生成】
"玩家询问了古董店和古代遗迹的信息。商人起初非常谨慎，
但随着对话的深入，逐渐表现出信任。玩家表示愿意帮助
寻找商人失踪的妹妹，商人透露了妹妹在北方遗迹失踪的信息。"

【记忆转化触发】
[promise|0.9] 玩家答应帮助神秘商人寻找失踪的妹妹
[relationship|0.8] 玩家与神秘商人建立了初步信任关系
[fact|0.8] 商人的妹妹在北方遗迹失踪
```

### 第11-15次对话（记忆被使用）
```
【系统提示词包含】
【历史对话总结】
玩家询问了古董店和古代遗迹的信息...

【相关记忆】
- 玩家答应帮助神秘商人寻找失踪的妹妹
- 玩家与神秘商人建立了初步信任关系
- 商人的妹妹在北方遗迹失踪

对话:
玩家: 我准备出发去北方了
NPC: (关切地) 你记得你答应过我什么吗？找到她...拜托了

玩家: 我会的，我不会忘记承诺
NPC: (感激地) 谢谢你...这个护身符给你，路上小心
```

---

## 🔍 检查点

### ✅ 思考系统正常
- [ ] 首次对话触发思考
- [ ] 思考内容符合角色设定
- [ ] 5次对话后重新思考（或配置的间隔）
- [ ] 思考内容根据情境更新

### ✅ 记忆系统正常
- [ ] 对话历史正确记录
- [ ] 超过5条（或配置的数量）后生成短期记忆
- [ ] 短期记忆准确总结对话内容
- [ ] 长期记忆提取关键信息（承诺、关系、事实等）
- [ ] 后续对话能检索到相关记忆

### ✅ 角色一致性
- [ ] NPC回复符合性格设定
- [ ] 对话风格保持一致
- [ ] 随着关系发展，态度有合理变化
- [ ] 能记住并遵守之前的承诺和约定

---

## 💡 调试技巧

### 查看系统提示词
```csharp
// 在 ChatAgent 中启用
ChatAgent.Instance.LogSystemPrompt = true;

// 在 Console 中查看完整的系统提示词
// 包含角色设定、记忆、思考等所有信息
```

### 查看思考内容
```csharp
// 在 ThoughtManager 中启用
ThoughtManager.Instance.LogThoughtContent = true;

// 在 Console 中查看思考过程
// 包含内心想法和行为指导
```

### 查看记忆操作
```csharp
// 在 ConversationManager 中启用
ConversationManager.Instance.LogMemoryOperations = true;

// 在 Console 中查看所有记忆操作
// 包括添加、提取、总结等
```

---

## 🎯 推荐的测试顺序

1. **基础对话测试** → 确保基本功能正常
2. **思考系统测试** → 确保思考触发和更新正常
3. **记忆系统测试** → 确保记忆提取和检索正常
4. **完整流程测试** → 模拟真实的长期对话
5. **压力测试** → 大量对话，测试性能和稳定性

---

**祝测试顺利！** 🎮✨




